---
import { Image } from 'astro:assets';
import type { Project, Blog } from '../types/dataTypes';
import MainLayout from './MainLayout.astro';
import Prose from '../components/Prose.astro';
import { SITE, ISPARTOF } from '../data/constant';
import { countWords } from '@/utils/countWords';
import Newsletter from '@/components/sections/Newsletter.astro';
import TableOfContents from '@/components/TableOfContents.astro';

interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  data: Project | Blog;
  slug: string;
  collection: string;
  body?: string;
  headings?: Heading[];
}

const { data, slug, collection, body, headings = [] }: Props = Astro.props;
const title: string = `${data.title} | ${SITE.title}`;
const description: string = data.description;

const wordCount = countWords(body || '');
const readTime = Math.ceil(wordCount / 200); // Assuming 200 words per minute

// Generate dynamic OG image path
const ogImagePath = `/og/${collection}/${slug}.png`;
---

<MainLayout
  title={title}
  structuredData={{
    '@context': 'https://schema.org',
    '@type': 'WebPage',
    '@id': `https://melnerdz.com/${collection}/${slug}`,
    url: `https://melnerdz.com/${collection}/${slug}`,
    name: `${data.title} | Melnerdz website`,
    description: description,
    isPartOf: ISPARTOF,
    inLanguage: 'en-US',
  }}
  meta={description}
  ogData={{
    title: `${data.title} | ${SITE.title}`,
    description: description,
    image: ogImagePath,
  }}
>
  <section class="mx-auto max-w-screen-xl py-6">
    <h1 class="mb-4 text-center font-headfont text-3xl font-bold">
      {data.title}
    </h1>

    <p class="mb-10 text-center text-sm text-neutral-500 dark:text-neutral-400">
      {
        data.pubDate
          ? new Date(data.pubDate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })
          : ''
      }
      &nbsp; â€¢ &nbsp;
      {readTime} min read
    </p>

    <div class="relative flex flex-col gap-10 lg:flex-row">
      <!-- Table of Contents - Left Sidebar -->
      {
        headings.length > 0 && (
          <aside class="hidden w-64 shrink-0 lg:block">
            <div class="sticky top-24">
              <TableOfContents headings={headings} />
            </div>
          </aside>
        )
      }

      <!-- Main Content -->
      <div class="mx-auto flex w-full max-w-prose flex-1 flex-col gap-5">
        <figure class="mx-auto w-full">
          <Image
            width={700}
            height={600}
            src={data.image.src}
            alt={data.image.alt}
            sizes="(max-width: 1024px) 100vw, 700px"
            class="h-auto w-full rounded-md"
          />
        </figure>
        <Prose>
          <slot />
        </Prose>
      </div>
    </div>
  </section>
  <Newsletter />
</MainLayout>
